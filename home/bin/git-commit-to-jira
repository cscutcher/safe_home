#!/usr/bin/env bash
set -o nounset
set -o errexit
set -o pipefail

COMMIT_RANGE="${1:-HEAD}"

MARKDOWN_MESSAGE=$(git \
    --no-pager \
    show \
    --no-show-signature \
    --compact-summary \
    --format='# %s (%h)%n_%ce_%n_%ci%_%n%n%b%n%nXXXSUMMARYXXX' \
    "$COMMIT_RANGE")

MARKDOWN_MESSAGE="$MARKDOWN_MESSAGE
XXXSUMMARYXXX"

JIRA_MESSAGE=$( \
    cat <<< $MARKDOWN_MESSAGE | \
    pandoc --from=gfm --to=jira | \
    sed 's/XXXSUMMARYXXX/{quote}/g'
)

cat <<< $JIRA_MESSAGE
xclip -sel clip -in <<< $JIRA_MESSAGE
