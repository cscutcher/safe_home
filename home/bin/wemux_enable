#!/bin/bash
set -o pipefail
set -o errexit
set -o nounset

LPASS_NOTE_ID=17157789507816980

AT_Q="z"
USERNAME="$(lpass show --username $LPASS_NOTE_ID)"
NEW_PASSWORD="$(pwgen 20 -y1)"

sudo echo "Updating Password"
echo ${USERNAME}:${NEW_PASSWORD} | sudo chpasswd
echo $NEW_PASSWORD | lpass edit --non-interactive --password $LPASS_NOTE_ID

echo "Connect with;"
echo "ssh -p2222 $USERNAME@$(ip -6 addr | egrep -o '2001:[a-f0-9:]*')"
echo ""
echo "Password is '$NEW_PASSWORD'"
